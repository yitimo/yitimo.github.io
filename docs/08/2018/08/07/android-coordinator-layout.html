<!DOCTYPE html>
<html>
<head>
    <title>Android中使用CoordinatorLayout進行佈局 | 再见二丁目</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>Android中使用CoordinatorLayout進行佈局</h1>
    <div><p>本文主要为整理 Android 中<code>CoordinatorLayout</code>的内置行为的使用。注意<code>CoordinatorLayout</code>的所有这些行为都得用在<code>Activity</code>的根布局中，也就是<code>Fragment</code>用不了。</p>
<h2>基本结构</h2>
<p>基於默認行爲的CoordinatorLayout至少要由5部分組成：</p>
<ol>
<li><code>CoornaditorLayout</code>標簽本身</li>
<li><code>AppBarLayout</code>代表了實現滾動效果部分，即滾動主體(列表等)滾動時會做出需要的特效的部分</li>
<li><code>CollapsingToolbarLayout</code> 字面意思即將摺叠部分的佈局，也就是之後滾動時要消失或是固定的佈局，直接放在<code>AppBarLayout</code>裏面</li>
<li><code>Toolbar</code>放在<code>CollapsingToolbarLayout</code>裏面，可以配置未摺叠時和摺叠后的行爲，直白的就是未摺叠時的大標題，摺叠后變成了左上角的小標題，這個就是靠<code>Toolbar</code></li>
<li>滾動主體本身，可以是個列表，也可以直接是個<code>NestedScrollView</code>，(不可以是<code>ScrollView</code>，這是個坑)，指定一個行爲后就可以與前4個部分進行響應了，默認行爲就用<code>appbar_scrolling_view_behavior</code>，也可以自定義行爲</li>
</ol>
<p>CoordinatorLayout AppBarLayout 與滾動主題 這三部分是固定的標簽，一般都是如下形式:</p>
<pre><code>&lt;android.support.design.widget.CoordinatorLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    tools:context=&quot;指定你的Activity&quot;&gt;
    &lt;android.support.design.widget.AppBarLayout
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;!-- 具體特效佈局 --&gt;
    &lt;/android.support.design.widget.AppBarLayout&gt;

    &lt;android.support.v4.widget.NestedScrollView
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;&gt;
        &lt;LinearLayout
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;center_vertical&quot;
            android:orientation=&quot;vertical&quot;&gt;
            &lt;!-- 滾動主體佈局 --&gt;
        &lt;/LinearLayout&gt;
    &lt;/android.support.v4.widget.NestedScrollView&gt;
&lt;/android.support.design.widget.CoordinatorLayout&gt;
</code></pre>
<h2>CollapsingToolbarLayout</h2>
<p>此佈局估計是導致<code>CoornaditorLayout</code>易使人困惑的萬惡之源，相對的<code>Toolbar</code>其實是個可有可無的標簽，是用來錦上添花的。
<code>CollapsingToolbarLayout</code>中最重要的屬性是<code>layout_scrollFlags</code>和<code>contentScrim</code>，前者直接決定這個佈局要如何相應滾動，後者決定標簽滾動至頂部以上(消失)時會漸變至設定的顔色，<code>layout_scrollFlags</code>有以下幾個值可以設定：</p>
<ol>
<li>不設置值 可以保持固定，不會隨滾動而消失了，可以理解爲： 未到頂部時跟隨滾動，到頂部后就固定在頂部。所以是個好東西，可以用來裝<code>TabLayout</code>之類的導航標簽。</li>
<li><code>scroll</code> 字面意思，就是正常滾動 其他值都要配合<code>scroll</code>来发挥效果</li>
<li><code>exitUntilCollapsed|scroll</code> 這兩者一起並配上 <code>contentScrim</code>，上滑時標簽會上滑至看不見(<code>scroll</code>的效果)，且還會漸變至設定的顔色(<code>contentScrim</code>的效果)</li>
<li><code>enterAlways|scroll</code> 上滑時效果跟<code>scroll</code>一樣，但由于<code>enterAlways</code>只要下滑就會再次出現，會受<code>contentScrim</code>影響，下滑時保持設定的顔色</li>
</ol>
<p>由于<code>CollapsingToolbarLayout</code>只能设置一种滚动方式，所以可以在一个<code>AppBarLayout</code>中添加多个，分别给不同的滚动方式，来实现想要的效果。不过要注意多个<code>CollapsingToolbarLayout</code>的排布顺序，其为线性从上往下排布，不同位置不同<code>layout_scrollFlags</code>都会有不同的表现结果，需要合理安排。</p>
<h2>ToolBar</h2>
<p><code>ToolBar</code>作为<code>CollapsingToolbarLayout</code>的子标签使用，可以响应折叠时与未折叠时两种状态。需要配置<code>layout_collapseMode</code>的值：</p>
<ol>
<li><code>pin</code>会固定位置</li>
<li><code>parallax</code>会跟随滚动</li>
</ol>
<p>一般可以实现的效果就是，<code>ToolBar</code>中放置一个返回按钮，同时在<code>CollapsingToolbarLayout</code>中设置<code>title</code>的值，这样就能做到：未折叠时显示大标题，折叠后大标题缩小至左上角返回按钮的旁边。</p>
</div>
</body>
</html>